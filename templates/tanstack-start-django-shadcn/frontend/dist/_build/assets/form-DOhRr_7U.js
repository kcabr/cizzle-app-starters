import{d as w,S as de,D as Z,r as k,j as n,u as te,z as S}from"./client-Bm6Vdnqp.js";import{B as W}from"./button-1p6NbWQA.js";import{I as N}from"./input-DhjTea2T.js";import{L as x}from"./label-Db2qutF5.js";import{C as ae}from"./checkbox-BwXPwVVv.js";import{S as he}from"./switch-Cxhce_M3.js";import"./check-B6B75W4y.js";import"./createLucideIcon-BdBzZ_PZ.js";function U(i,l){return typeof i=="function"?i(l):i}function ne(i,l){return se(l).reduce((e,t)=>{if(e===null)return null;if(typeof e<"u")return e[t]},i)}function G(i,l,s){const e=se(l);function t(a){if(!e.length)return U(s,a);const r=e.shift();if(typeof r=="string"||typeof r=="number"&&!Array.isArray(a))return typeof a=="object"?(a===null&&(a={}),{...a,[r]:t(a[r])}):{[r]:t()};if(Array.isArray(a)&&typeof r=="number"){const u=a.slice(0,r);return[...u.length?u:new Array(r),t(a[r]),...a.slice(r+1)]}return[...new Array(r),t()]}return t(i)}function me(i,l){const s=se(l);function e(t){if(!t)return;if(s.length===1){const r=s[0];if(Array.isArray(t)&&typeof r=="number")return t.filter((c,d)=>d!==r);const{[r]:u,...f}=t;return f}const a=s.shift();if(typeof a=="string"&&typeof t=="object")return{...t,[a]:e(t[a])};if(typeof a=="number"&&Array.isArray(t)){if(a>=t.length)return t;const r=t.slice(0,a);return[...r.length?r:new Array(a),e(t[a]),...t.slice(a+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(i)}const ve=/^(\d*)$/gm,fe=/\.(\d*)\./gm,pe=/^(\d*)\./gm,ge=/\.(\d*$)/gm,Me=/\.{2,}/gm,q="__int__",O=`${q}$1`;function se(i){if(Array.isArray(i))return[...i];if(typeof i!="string")throw new Error("Path must be a string.");return i.replace(/\[/g,".").replace(/\]/g,"").replace(ve,O).replace(fe,`.${O}.`).replace(pe,`${O}.`).replace(ge,`.${O}`).replace(Me,".").split(".").map(l=>l.indexOf(q)===0?parseInt(l.substring(q.length),10):l)}function be(i){return!(Array.isArray(i)&&i.length===0)}function Q(i,l){const{asyncDebounceMs:s}=l,{onChangeAsync:e,onBlurAsync:t,onSubmitAsync:a,onBlurAsyncDebounceMs:r,onChangeAsyncDebounceMs:u}=l.validators||{},f=s??0,c={cause:"change",validate:e,debounceMs:u??f},d={cause:"blur",validate:t,debounceMs:r??f},h={cause:"submit",validate:a,debounceMs:0},o=m=>({...m,debounceMs:0});switch(i){case"submit":return[o(c),o(d),h];case"blur":return[d];case"change":return[c];case"server":default:return[]}}function X(i,l){const{onChange:s,onBlur:e,onSubmit:t,onMount:a}=l.validators||{},r={cause:"change",validate:s},u={cause:"blur",validate:e},f={cause:"submit",validate:t},c={cause:"mount",validate:a},d={cause:"server",validate:()=>{}};switch(i){case"mount":return[c];case"submit":return[r,u,f,d];case"server":return[d];case"blur":return[u,d];case"change":default:return[r,d]}}const oe=i=>!!i&&typeof i=="object"&&"fields"in i;function H(i,l){if(Object.is(i,l))return!0;if(typeof i!="object"||i===null||typeof l!="object"||l===null)return!1;if(i instanceof Map&&l instanceof Map){if(i.size!==l.size)return!1;for(const[e,t]of i)if(!l.has(e)||!Object.is(t,l.get(e)))return!1;return!0}if(i instanceof Set&&l instanceof Set){if(i.size!==l.size)return!1;for(const e of i)if(!l.has(e))return!1;return!0}const s=Object.keys(i);if(s.length!==Object.keys(l).length)return!1;for(let e=0;e<s.length;e++)if(!Object.prototype.hasOwnProperty.call(l,s[e])||!Object.is(i[s[e]],l[s[e]]))return!1;return!0}function ye(i){const l=new Map;for(const s of i){const e=[...s.path??[]].map(t=>{const a=typeof t=="object"?t.key:t;return typeof a=="number"?`[${a}]`:a}).join(".").replace(/\.\[/g,"[");l.set(e,(l.get(e)??[]).concat(s))}return Object.fromEntries(l)}const Fe=i=>i,Se=i=>{const l=ye(i);return{form:l,fields:l}},re=(i,l)=>i==="form"?Se(l):Fe(l),le={validate({value:i,validationSource:l},s){const e=s["~standard"].validate(i);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return re(l,e.issues)},async validateAsync({value:i,validationSource:l},s){const e=await s["~standard"].validate(i);if(e.issues)return re(l,e.issues)}},ue=i=>!!i&&"~standard"in i,z={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,errors:[],errorMap:{}};function D(i){function l(h,o,m,v){const p=e(h,o,m,v);({insert:()=>u(p,h,o),remove:()=>f(p),swap:()=>v!==void 0&&d(p,h,o,v),move:()=>v!==void 0&&c(p,h,o,v)})[m]()}function s(h,o){return`${h}[${o}]`}function e(h,o,m,v){const p=[s(h,o)];if(m==="swap")p.push(s(h,v));else if(m==="move"){const[g,y]=[Math.min(o,v),Math.max(o,v)];for(let M=g;M<=y;M++)p.push(s(h,M))}else{const g=i.getFieldValue(h),y=Array.isArray(g)?g.length:0;for(let M=o+1;M<y;M++)p.push(s(h,M))}return Object.keys(i.fieldInfo).filter(g=>p.some(y=>g.startsWith(y)))}function t(h,o){return h.replace(/\[(\d+)\]/,(m,v)=>{const p=parseInt(v,10);return`[${o==="up"?p+1:Math.max(0,p-1)}]`})}function a(h,o){(o==="up"?h:[...h].reverse()).forEach(v=>{const p=t(v.toString(),o),g=i.getFieldMeta(p);g?i.setFieldMeta(v,g):i.setFieldMeta(v,r())})}const r=()=>z,u=(h,o,m)=>{a(h,"down"),h.forEach(v=>{v.toString().startsWith(s(o,m))&&i.setFieldMeta(v,r())})},f=h=>{a(h,"up")},c=(h,o,m,v)=>{const p=new Map(Object.keys(i.fieldInfo).filter(g=>g.startsWith(s(o,m))).map(g=>[g,i.getFieldMeta(g)]));a(h,m<v?"up":"down"),Object.keys(i.fieldInfo).filter(g=>g.startsWith(s(o,v))).forEach(g=>{const y=g.replace(s(o,v),s(o,m)),M=p.get(y);M&&i.setFieldMeta(g,M)})},d=(h,o,m,v)=>{h.forEach(p=>{if(!p.toString().startsWith(s(o,m)))return;const g=p.toString().replace(s(o,m),s(o,v)),[y,M]=[i.getFieldMeta(p),i.getFieldMeta(g)];y&&i.setFieldMeta(g,y),M&&i.setFieldMeta(p,M)})};return{handleArrayFieldMetaShift:l}}function J(i){return{values:i.values??{},errorMap:i.errorMap??{},fieldMetaBase:i.fieldMetaBase??{},isSubmitted:i.isSubmitted??!1,isSubmitting:i.isSubmitting??!1,isValidating:i.isValidating??!1,submissionAttempts:i.submissionAttempts??0,isSubmitSuccessful:i.isSubmitSuccessful??!1,validationMetaMap:i.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class xe{constructor(l){var s;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.cumulativeFieldsErrorMap={},this.mount=()=>{const e=this.fieldMetaDerived.mount(),t=this.store.mount(),a=()=>{e(),t()},{onMount:r}=this.options.validators||{};return r&&this.validateSync("mount"),a},this.update=e=>{var t,a;if(!e)return;const r=this.options;this.options=e;const u=!!((a=(t=e.transform)==null?void 0:t.deps)!=null&&a.some((d,h)=>d!==this.prevTransformArray[h])),f=e.defaultValues&&!H(e.defaultValues,r.defaultValues)&&!this.state.isTouched,c=!H(e.defaultState,r.defaultState)&&!this.state.isTouched;!f&&!c&&!u||w(()=>{this.baseStore.setState(()=>J(Object.assign({},this.state,c?e.defaultState:{},f?{values:e.defaultValues}:{},u?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(e,t)=>{const{fieldMeta:a}=this.state,r=this.resetFieldMeta(a);e&&!t?.keepDefaultValues&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var u;return J({...this.options.defaultState,values:e??this.options.defaultValues??((u=this.options.defaultState)==null?void 0:u.values),fieldMetaBase:r})})},this.validateAllFields=async e=>{const t=[];return w(()=>{Object.values(this.fieldInfo).forEach(r=>{if(!r.instance)return;const u=r.instance;t.push(Promise.resolve().then(()=>u.validate(e,{skipFormValidation:!0}))),r.instance.state.meta.isTouched||r.instance.setMeta(f=>({...f,isTouched:!0}))})}),(await Promise.all(t)).flat()},this.validateArrayFieldsStartingFrom=async(e,t,a)=>{const r=this.getFieldValue(e),u=Array.isArray(r)?Math.max(r.length-1,0):null,f=[`${e}[${t}]`];for(let o=t+1;o<=(u??0);o++)f.push(`${e}[${o}]`);const c=Object.keys(this.fieldInfo).filter(o=>f.some(m=>o.startsWith(m))),d=[];return w(()=>{c.forEach(o=>{d.push(Promise.resolve().then(()=>this.validateField(o,a)))})}),(await Promise.all(d)).flat()},this.validateField=(e,t)=>{var a;const r=(a=this.fieldInfo[e])==null?void 0:a.instance;return r?(r.state.meta.isTouched||r.setMeta(u=>({...u,isTouched:!0})),r.validate(t)):[]},this.validateSync=e=>{const t=X(e,this.options);let a=!1;const r={};return w(()=>{var u;for(const c of t){if(!c.validate)continue;const d=this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:h,fieldErrors:o}=ee(d),m=$(c.cause);if(o)for(const[v,p]of Object.entries(o)){const y={...this.cumulativeFieldsErrorMap[v]||{},[m]:p};r[v]=y,this.cumulativeFieldsErrorMap[v]=y;const M=this.getFieldMeta(v);M&&M.errorMap[m]!==p&&this.setFieldMeta(v,F=>({...F,errorMap:{...F.errorMap,[m]:p}}))}for(const v of Object.keys(this.cumulativeFieldsErrorMap)){const p=this.getFieldMeta(v);p?.errorMap[m]&&!((u=r[v])!=null&&u[m])&&(this.cumulativeFieldsErrorMap[v]={...this.cumulativeFieldsErrorMap[v],[m]:void 0},this.setFieldMeta(v,g=>({...g,errorMap:{...g.errorMap,[m]:void 0}})))}this.state.errorMap[m]!==h&&this.baseStore.setState(v=>({...v,errorMap:{...v.errorMap,[m]:h}})),(h||o)&&(a=!0)}const f=$("submit");this.state.errorMap[f]&&e!=="submit"&&!a&&this.baseStore.setState(c=>({...c,errorMap:{...c.errorMap,[f]:void 0}}))}),{hasErrored:a,fieldsErrorMap:r}},this.validateAsync=async e=>{const t=Q(e,this.options);this.state.isFormValidating||this.baseStore.setState(c=>({...c,isFormValidating:!0}));const a=[];let r;for(const c of t){if(!c.validate)continue;const d=$(c.cause),h=this.state.validationMetaMap[d];h?.lastAbortController.abort();const o=new AbortController;this.state.validationMetaMap[d]={lastAbortController:o},a.push(new Promise(async m=>{let v;try{v=await new Promise((M,F)=>{setTimeout(async()=>{if(o.signal.aborted)return M(void 0);try{M(await this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:o.signal},type:"validateAsync"}))}catch(E){F(E)}},c.debounceMs)})}catch(M){v=M}const{formError:p,fieldErrors:g}=ee(v);g&&(r=r?{...r,...g}:g);const y=$(c.cause);if(r)for(const[M,F]of Object.entries(r)){const E=this.getFieldMeta(M);E&&E.errorMap[y]!==F&&this.setFieldMeta(M,B=>({...B,errorMap:{...B.errorMap,[y]:F}}))}this.baseStore.setState(M=>({...M,errorMap:{...M.errorMap,[y]:p}})),m(r?{fieldErrors:r,errorMapKey:y}:void 0)}))}let u=[];const f={};if(a.length){u=await Promise.all(a);for(const c of u)if(c?.fieldErrors){const{errorMapKey:d}=c;for(const[h,o]of Object.entries(c.fieldErrors)){const v={...f[h]||{},[d]:o};f[h]=v}}}return this.baseStore.setState(c=>({...c,isFormValidating:!1})),f},this.validate=e=>{const{hasErrored:t,fieldsErrorMap:a}=this.validateSync(e);return t&&!this.options.asyncAlways?a:this.validateAsync(e)},this.getFieldValue=e=>ne(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var t;return(t=this.fieldInfo)[e]||(t[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(e,t)=>{this.baseStore.setState(a=>({...a,fieldMetaBase:{...a.fieldMetaBase,[e]:U(t,a.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((t,a)=>{const r=a;return t[r]=z,t},{}),this.setFieldValue=(e,t,a)=>{const r=a?.dontUpdateMeta??!1;w(()=>{r||this.setFieldMeta(e,u=>({...u,isTouched:!0,isDirty:!0,errorMap:{...u?.errorMap,onMount:void 0}})),this.baseStore.setState(u=>({...u,values:G(u.values,e,t)}))})},this.deleteField=e=>{const a=[...Object.keys(this.fieldInfo).filter(r=>{const u=e.toString();return r!==u&&r.startsWith(u)}),e];this.baseStore.setState(r=>{const u={...r};return a.forEach(f=>{u.values=me(u.values,f),delete this.fieldInfo[f],delete u.fieldMetaBase[f]}),u})},this.pushFieldValue=(e,t,a)=>{this.setFieldValue(e,r=>[...Array.isArray(r)?r:[],t],a),this.validateField(e,"change")},this.insertFieldValue=async(e,t,a,r)=>{this.setFieldValue(e,u=>[...u.slice(0,t),a,...u.slice(t)],r),await this.validateField(e,"change"),D(this).handleArrayFieldMetaShift(e,t,"insert"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.replaceFieldValue=async(e,t,a,r)=>{this.setFieldValue(e,u=>u.map((f,c)=>c===t?a:f),r),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.removeFieldValue=async(e,t,a)=>{const r=this.getFieldValue(e),u=Array.isArray(r)?Math.max(r.length-1,0):null;if(this.setFieldValue(e,f=>f.filter((c,d)=>d!==t),a),D(this).handleArrayFieldMetaShift(e,t,"remove"),u!==null){const f=`${e}[${u}]`;this.deleteField(f)}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.swapFieldValues=(e,t,a,r)=>{this.setFieldValue(e,u=>{const f=u[t],c=u[a];return G(G(u,`${t}`,c),`${a}`,f)},r),D(this).handleArrayFieldMetaShift(e,t,"swap",a),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${a}]`,"change")},this.moveFieldValues=(e,t,a,r)=>{this.setFieldValue(e,u=>(u.splice(a,0,u.splice(t,1)[0]),u),r),D(this).handleArrayFieldMetaShift(e,t,"move",a),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${a}]`,"change")},this.resetField=e=>{this.baseStore.setState(t=>({...t,fieldMetaBase:{...t.fieldMetaBase,[e]:z},values:{...t.values,[e]:this.options.defaultValues&&this.options.defaultValues[e]}}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[t,a])=>(Object.keys(a).length&&a.errors.length&&(e[t]={errors:a.errors,errorMap:a.errorMap}),e),{})}),this.baseStore=new de(J({...l?.defaultState,values:l?.defaultValues??((s=l?.defaultState)==null?void 0:s.values)})),this.fieldMetaDerived=new Z({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:t,prevVal:a})=>{var r;const u=a,f=e?.[0],c=t[0];let d=0;const h={};for(const o of Object.keys(c.fieldMetaBase)){const m=c.fieldMetaBase[o],v=f?.fieldMetaBase[o],p=u?.[o];let g=p?.errors;if(!v||m.errorMap!==v.errorMap){g=Object.values(m.errorMap??{}).filter(F=>F!==void 0);const M=(r=this.getFieldInfo(o))==null?void 0:r.instance;M&&!M.options.disableErrorFlat&&(g=g?.flat(1))}const y=!m.isDirty;if(p&&p.isPristine===y&&p.errors===g&&m===v){h[o]=p,d++;continue}h[o]={...m,errors:g,isPristine:y}}return Object.keys(c.fieldMetaBase).length&&u&&d===Object.keys(c.fieldMetaBase).length?u:h}}),this.store=new Z({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:t,prevVal:a})=>{var r,u,f,c;const d=a,h=e?.[0],o=t[0],m=Object.values(o.fieldMetaBase),v=m.some(b=>b?.isValidating),p=!m.some(b=>b?.errorMap&&be(Object.values(b.errorMap).filter(Boolean))),g=m.some(b=>b?.isTouched),y=m.some(b=>b?.isBlurred),M=g&&((r=o?.errorMap)==null?void 0:r.onMount),F=m.some(b=>b?.isDirty),E=!F,B=!!((u=o.errorMap)!=null&&u.onMount||m.some(b=>{var A;return(A=b?.errorMap)==null?void 0:A.onMount})),Y=!!v;let C=d?.errors??[];(!h||o.errorMap!==h.errorMap)&&(C=Object.values(o.errorMap).reduce((b,A)=>A===void 0?b:A&&oe(A)?(b.push(A.form),b):(b.push(A),b),[]));const V=C.length===0,_=p&&V,P=o.submissionAttempts===0&&!g&&!B||!Y&&!o.isSubmitting&&_;let T=o.errorMap;if(M&&(C=C.filter(b=>b!==o.errorMap.onMount),T=Object.assign(T,{onMount:void 0})),d&&h&&d.errorMap===T&&d.fieldMeta===this.fieldMetaDerived.state&&d.errors===C&&d.isFieldsValidating===v&&d.isFieldsValid===p&&d.isFormValid===V&&d.isValid===_&&d.canSubmit===P&&d.isTouched===g&&d.isBlurred===y&&d.isPristine===E&&d.isDirty===F&&H(h,o))return d;let R={...o,errorMap:T,fieldMeta:this.fieldMetaDerived.state,errors:C,isFieldsValidating:v,isFieldsValid:p,isFormValid:V,isValid:_,canSubmit:P,isTouched:g,isBlurred:y,isPristine:E,isDirty:F};const K=((f=this.options.transform)==null?void 0:f.deps)??[];if(K.length!==this.prevTransformArray.length||K.some((b,A)=>b!==this.prevTransformArray[A])){const b=Object.assign({},this,{state:R});(c=this.options.transform)==null||c.fn(b),R=b.state,this.prevTransformArray=K}return R}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(l||{})}get state(){return this.store.state}runValidator(l){return ue(l.validate)?le[l.type](l.value,l.validate):l.validate(l.value)}async handleSubmit(l){var s,e,t,a,r,u;if(this.baseStore.setState(c=>({...c,isSubmitted:!1,submissionAttempts:c.submissionAttempts+1,isSubmitSuccessful:!1})),!this.state.canSubmit)return;this.baseStore.setState(c=>({...c,isSubmitting:!0}));const f=()=>{this.baseStore.setState(c=>({...c,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){f(),(e=(s=this.options).onSubmitInvalid)==null||e.call(s,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){f(),(a=(t=this.options).onSubmitInvalid)==null||a.call(t,{value:this.state.values,formApi:this});return}w(()=>{Object.values(this.fieldInfo).forEach(c=>{var d,h,o;(o=(h=(d=c.instance)==null?void 0:d.options.listeners)==null?void 0:h.onSubmit)==null||o.call(h,{value:c.instance.state.value,fieldApi:c.instance})})});try{await((u=(r=this.options).onSubmit)==null?void 0:u.call(r,{value:this.state.values,formApi:this,meta:l??this.options.onSubmitMeta})),w(()=>{this.baseStore.setState(c=>({...c,isSubmitted:!0,isSubmitSuccessful:!0})),f()})}catch(c){throw this.baseStore.setState(d=>({...d,isSubmitSuccessful:!1})),f(),c}}setErrorMap(l){this.baseStore.setState(s=>({...s,errorMap:{...s.errorMap,...l}}))}}function ee(i){if(i){if(oe(i)){const l=ee(i.form).formError,s=i.fields;return{formError:l,fieldErrors:s}}return{formError:i}}return{formError:void 0}}function $(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class je{constructor(l){this.options={},this.mount=()=>{var s,e;const t=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const a=this.getInfo();a.instance=this,this.update(this.options);const{onMount:r}=this.options.validators||{};if(r){const u=this.runValidator({validate:r,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});u&&this.setMeta(f=>({...f,errorMap:{...f?.errorMap,onMount:u}}))}return(e=(s=this.options.listeners)==null?void 0:s.onMount)==null||e.call(s,{value:this.state.value,fieldApi:this}),t},this.update=s=>{if(this.state.value===void 0){const e=ne(s.form.options.defaultValues,s.name);s.defaultValue!==void 0?this.setValue(s.defaultValue,{dontUpdateMeta:!0}):e!==void 0&&this.setValue(e,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta),this.options=s,this.name=s.name},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(s,e)=>{var t,a;this.form.setFieldValue(this.name,s,e),(a=(t=this.options.listeners)==null?void 0:t.onChange)==null||a.call(t,{value:this.state.value,fieldApi:this}),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=s=>this.form.setFieldMeta(this.name,s),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(s,e)=>{var t,a;this.form.pushFieldValue(this.name,s,e),(a=(t=this.options.listeners)==null?void 0:t.onChange)==null||a.call(t,{value:this.state.value,fieldApi:this})},this.insertValue=(s,e,t)=>{var a,r;this.form.insertFieldValue(this.name,s,e,t),(r=(a=this.options.listeners)==null?void 0:a.onChange)==null||r.call(a,{value:this.state.value,fieldApi:this})},this.replaceValue=(s,e,t)=>{var a,r;this.form.replaceFieldValue(this.name,s,e,t),(r=(a=this.options.listeners)==null?void 0:a.onChange)==null||r.call(a,{value:this.state.value,fieldApi:this})},this.removeValue=(s,e)=>{var t,a;this.form.removeFieldValue(this.name,s,e),(a=(t=this.options.listeners)==null?void 0:t.onChange)==null||a.call(t,{value:this.state.value,fieldApi:this})},this.swapValues=(s,e,t)=>{var a,r;this.form.swapFieldValues(this.name,s,e,t),(r=(a=this.options.listeners)==null?void 0:a.onChange)==null||r.call(a,{value:this.state.value,fieldApi:this})},this.moveValue=(s,e,t)=>{var a,r;this.form.moveFieldValues(this.name,s,e,t),(r=(a=this.options.listeners)==null?void 0:a.onChange)==null||r.call(a,{value:this.state.value,fieldApi:this})},this.getLinkedFields=s=>{const e=Object.values(this.form.fieldInfo),t=[];for(const a of e){if(!a.instance)continue;const{onChangeListenTo:r,onBlurListenTo:u}=a.instance.options.validators||{};s==="change"&&r?.includes(this.name)&&t.push(a.instance),s==="blur"&&u?.includes(this.name)&&t.push(a.instance)}return t},this.validateSync=(s,e)=>{const t=X(s,this.options),r=this.getLinkedFields(s).reduce((c,d)=>{const h=X(s,d.options);return h.forEach(o=>{o.field=d}),c.concat(h)},[]);let u=!1;w(()=>{const c=(d,h)=>{const o=I(h.cause),m=h.validate?ie(d.runValidator({validate:h.validate,value:{value:d.store.state.value,validationSource:"field",fieldApi:d},type:"validate"})):e[o];d.state.meta.errorMap[o]!==m&&d.setMeta(v=>({...v,errorMap:{...v.errorMap,[I(h.cause)]:m||e[o]}})),(m||e[o])&&(u=!0)};for(const d of t)c(this,d);for(const d of r)d.validate&&c(d.field,d)});const f=I("submit");return this.state.meta.errorMap[f]&&s!=="submit"&&!u&&this.setMeta(c=>({...c,errorMap:{...c.errorMap,[f]:void 0}})),{hasErrored:u}},this.validateAsync=async(s,e)=>{const t=Q(s,this.options),a=await e,r=this.getLinkedFields(s),u=r.reduce((o,m)=>{const v=Q(s,m.options);return v.forEach(p=>{p.field=m}),o.concat(v)},[]);this.state.meta.isValidating||this.setMeta(o=>({...o,isValidating:!0}));for(const o of r)o.setMeta(m=>({...m,isValidating:!0}));const f=[],c=[],d=(o,m,v)=>{const p=I(m.cause),g=o.getInfo().validationMetaMap[p];g?.lastAbortController.abort();const y=new AbortController;this.getInfo().validationMetaMap[p]={lastAbortController:y},v.push(new Promise(async M=>{var F;let E;try{E=await new Promise((V,_)=>{this.timeoutIds[m.cause]&&clearTimeout(this.timeoutIds[m.cause]),this.timeoutIds[m.cause]=setTimeout(async()=>{if(y.signal.aborted)return V(void 0);try{V(await this.runValidator({validate:m.validate,value:{value:o.store.state.value,fieldApi:o,signal:y.signal,validationSource:"field"},type:"validateAsync"}))}catch(P){_(P)}},m.debounceMs)})}catch(V){E=V}if(y.signal.aborted)return M(void 0);const B=ie(E),Y=(F=a[this.name])==null?void 0:F[p],C=B||Y;o.setMeta(V=>({...V,errorMap:{...V?.errorMap,[p]:C}})),M(C)}))};for(const o of t)o.validate&&d(this,o,f);for(const o of u)o.validate&&d(o.field,o,c);let h=[];(f.length||c.length)&&(h=await Promise.all(f),await Promise.all(c)),this.setMeta(o=>({...o,isValidating:!1}));for(const o of r)o.setMeta(m=>({...m,isValidating:!1}));return h.filter(Boolean)},this.validate=(s,e)=>{var t;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:a}=e?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(s),{hasErrored:r}=this.validateSync(s,a[this.name]??{});if(r&&!this.options.asyncAlways)return(t=this.getInfo().validationMetaMap[I(s)])==null||t.lastAbortController.abort(),this.state.meta.errors;const u=e?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(s);return this.validateAsync(s,u)},this.handleChange=s=>{this.setValue(s)},this.handleBlur=()=>{var s,e;this.state.meta.isTouched||(this.setMeta(a=>({...a,isTouched:!0})),this.validate("change")),this.state.meta.isBlurred||this.setMeta(a=>({...a,isBlurred:!0})),this.validate("blur"),(e=(s=this.options.listeners)==null?void 0:s.onBlur)==null||e.call(s,{value:this.state.value,fieldApi:this})},this.form=l.form,this.name=l.name,this.timeoutIds={},this.store=new Z({deps:[this.form.store],fn:()=>{const s=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{...z,...l.defaultMeta};return{value:s,meta:e}}}),this.options=l}get state(){return this.store.state}runValidator(l){return ue(l.validate)?le[l.type](l.value,l.validate):l.validate(l.value)}setErrorMap(l){this.setMeta(s=>({...s,errorMap:{...s.errorMap,...l}}))}}function ie(i){if(i)return i}function I(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}const L=typeof window<"u"?k.useLayoutEffect:k.useEffect;function Ve(i){const[l]=k.useState(()=>{const e=new je({...i,form:i.form,name:i.name});return e.Field=ce,e});return L(l.mount,[l]),L(()=>{l.update(i)}),te(l.store,i.mode==="array"?s=>[s.meta,Object.keys(s.value??[]).length]:void 0),l}const ce=({children:i,...l})=>{const s=Ve(l),e=k.useMemo(()=>U(i,s),[i,s,s.state.value,s.state.meta]);return n.jsx(n.Fragment,{children:e})};function Ee({form:i,selector:l,children:s}){const e=te(i.store,l);return U(s,e)}function Ae(i){const[l]=k.useState(()=>{const s=new xe(i),e=s;return e.Field=function(a){return n.jsx(ce,{...a,form:s})},e.Subscribe=t=>n.jsx(Ee,{form:s,selector:t.selector,children:t.children}),e});return L(l.mount,[]),te(l.store,s=>s.isSubmitting),L(()=>{l.update(i)}),l}const j=S.object({personal:S.object({firstName:S.string().min(2,{message:"First name must be at least 2 characters"}),lastName:S.string().min(2,{message:"Last name must be at least 2 characters"}),email:S.string().email({message:"Please enter a valid email address"}),age:S.string().optional().transform(i=>i?parseInt(i,10):void 0)}),address:S.object({street:S.string().min(5,{message:"Street address must be at least 5 characters"}),city:S.string().min(2,{message:"City must be at least 2 characters"}),state:S.string().min(2,{message:"State must be at least 2 characters"}),zipCode:S.string().regex(/^\d{5}(-\d{4})?$/,{message:"Please enter a valid zip code"})}),preferences:S.object({receiveEmails:S.boolean().default(!1),receiveSMS:S.boolean().default(!1),theme:S.enum(["light","dark","system"]).default("system")}),terms:S.boolean().refine(i=>i===!0,{message:"You must accept the terms and conditions"})});function Ce(){const[i,l]=k.useState(""),s=Ae({defaultValues:{personal:{firstName:"",lastName:"",email:"",age:""},address:{street:"",city:"",state:"",zipCode:""},preferences:{receiveEmails:!1,receiveSMS:!1,theme:"system"},terms:!1},onSubmit:async({value:e})=>{await new Promise(t=>setTimeout(t,1e3)),l(JSON.stringify(e,null,2))}});return n.jsxs("div",{className:"max-w-3xl mx-auto p-6",children:[n.jsx("h1",{className:"text-2xl font-bold mb-6",children:"TanStack Form Demo"}),n.jsxs("form",{onSubmit:e=>{e.preventDefault(),e.stopPropagation(),s.handleSubmit()},className:"space-y-8",children:[n.jsxs("div",{className:"bg-card p-6 rounded-lg shadow-sm",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Personal Information"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(s.Field,{name:"personal.firstName",validators:{onChange:e=>{try{return j.shape.personal.shape.firstName.parse(e),{status:"success"}}catch{return{status:"error",error:"First name must be at least 2 characters"}}},onBlur:e=>{try{return j.shape.personal.shape.firstName.parse(e),{status:"success"}}catch{return{status:"error",error:"First name must be at least 2 characters"}}}},children:e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx(x,{htmlFor:e.name,children:"First Name"}),n.jsx(N,{id:e.name,name:e.name,value:e.state.value,onBlur:e.handleBlur,onChange:t=>e.handleChange(t.target.value)}),e.state.meta.errors&&e.state.meta.errors[0]?.error?n.jsx("p",{className:"text-sm text-destructive",children:e.state.meta.errors[0].error}):null]})}),n.jsx(s.Field,{name:"personal.lastName",validators:{onChange:e=>{try{return j.shape.personal.shape.lastName.parse(e),{status:"success"}}catch{return{status:"error",error:"Last name must be at least 2 characters"}}},onBlur:e=>{try{return j.shape.personal.shape.lastName.parse(e),{status:"success"}}catch{return{status:"error",error:"Last name must be at least 2 characters"}}}},children:e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx(x,{htmlFor:e.name,children:"Last Name"}),n.jsx(N,{id:e.name,name:e.name,value:e.state.value,onBlur:e.handleBlur,onChange:t=>e.handleChange(t.target.value)}),e.state.meta.errors&&e.state.meta.errors[0]?.error?n.jsx("p",{className:"text-sm text-destructive",children:e.state.meta.errors[0].error}):null]})}),n.jsx(s.Field,{name:"personal.email",validators:{onChange:e=>{try{return j.shape.personal.shape.email.parse(e),{status:"success"}}catch{return{status:"error",error:"Please enter a valid email address"}}},onBlur:e=>{try{return j.shape.personal.shape.email.parse(e),{status:"success"}}catch{return{status:"error",error:"Please enter a valid email address"}}}},children:e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx(x,{htmlFor:e.name,children:"Email"}),n.jsx(N,{id:e.name,name:e.name,type:"email",value:e.state.value,onBlur:e.handleBlur,onChange:t=>e.handleChange(t.target.value)}),e.state.meta.errors&&e.state.meta.errors[0]?.error?n.jsx("p",{className:"text-sm text-destructive",children:e.state.meta.errors[0].error}):null]})}),n.jsx(s.Field,{name:"personal.age",validators:{onChange:e=>{if(!e)return{status:"success"};const t=parseInt(e,10);return isNaN(t)?{status:"error",error:"Age must be a number"}:t<18?{status:"error",error:"You must be at least 18 years old"}:{status:"success"}},onBlur:e=>{if(!e)return{status:"success"};const t=parseInt(e,10);return isNaN(t)?{status:"error",error:"Age must be a number"}:t<18?{status:"error",error:"You must be at least 18 years old"}:{status:"success"}}},children:e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx(x,{htmlFor:e.name,children:"Age"}),n.jsx(N,{id:e.name,name:e.name,type:"number",value:e.state.value,onBlur:e.handleBlur,onChange:t=>e.handleChange(t.target.value)}),e.state.meta.errors&&e.state.meta.errors[0]?.error?n.jsx("p",{className:"text-sm text-destructive",children:e.state.meta.errors[0].error}):null]})})]})]}),n.jsxs("div",{className:"bg-card p-6 rounded-lg shadow-sm",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Address"}),n.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[n.jsx(s.Field,{name:"address.street",validators:{onChange:e=>{try{return j.shape.address.shape.street.parse(e),{status:"success"}}catch{return{status:"error",error:"Street address must be at least 5 characters"}}},onBlur:e=>{try{return j.shape.address.shape.street.parse(e),{status:"success"}}catch{return{status:"error",error:"Street address must be at least 5 characters"}}}},children:e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx(x,{htmlFor:e.name,children:"Street"}),n.jsx(N,{id:e.name,name:e.name,value:e.state.value,onBlur:e.handleBlur,onChange:t=>e.handleChange(t.target.value)}),e.state.meta.errors&&e.state.meta.errors[0]?.error?n.jsx("p",{className:"text-sm text-destructive",children:e.state.meta.errors[0].error}):null]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx(s.Field,{name:"address.city",validators:{onChange:e=>{try{return j.shape.address.shape.city.parse(e),{status:"success"}}catch{return{status:"error",error:"City must be at least 2 characters"}}},onBlur:e=>{try{return j.shape.address.shape.city.parse(e),{status:"success"}}catch{return{status:"error",error:"City must be at least 2 characters"}}}},children:e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx(x,{htmlFor:e.name,children:"City"}),n.jsx(N,{id:e.name,name:e.name,value:e.state.value,onBlur:e.handleBlur,onChange:t=>e.handleChange(t.target.value)}),e.state.meta.errors&&e.state.meta.errors[0]?.error?n.jsx("p",{className:"text-sm text-destructive",children:e.state.meta.errors[0].error}):null]})}),n.jsx(s.Field,{name:"address.state",validators:{onChange:e=>{try{return j.shape.address.shape.state.parse(e),{status:"success"}}catch{return{status:"error",error:"State must be at least 2 characters"}}},onBlur:e=>{try{return j.shape.address.shape.state.parse(e),{status:"success"}}catch{return{status:"error",error:"State must be at least 2 characters"}}}},children:e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx(x,{htmlFor:e.name,children:"State"}),n.jsx(N,{id:e.name,name:e.name,value:e.state.value,onBlur:e.handleBlur,onChange:t=>e.handleChange(t.target.value)}),e.state.meta.errors&&e.state.meta.errors[0]?.error?n.jsx("p",{className:"text-sm text-destructive",children:e.state.meta.errors[0].error}):null]})}),n.jsx(s.Field,{name:"address.zipCode",validators:{onChange:e=>{try{return j.shape.address.shape.zipCode.parse(e),{status:"success"}}catch{return{status:"error",error:"Please enter a valid zip code"}}},onBlur:e=>{try{return j.shape.address.shape.zipCode.parse(e),{status:"success"}}catch{return{status:"error",error:"Please enter a valid zip code"}}}},children:e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx(x,{htmlFor:e.name,children:"Zip Code"}),n.jsx(N,{id:e.name,name:e.name,value:e.state.value,onBlur:e.handleBlur,onChange:t=>e.handleChange(t.target.value)}),e.state.meta.errors&&e.state.meta.errors[0]?.error?n.jsx("p",{className:"text-sm text-destructive",children:e.state.meta.errors[0].error}):null]})})]})]})]}),n.jsxs("div",{className:"bg-card p-6 rounded-lg shadow-sm",children:[n.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Preferences"}),n.jsxs("div",{className:"space-y-4",children:[n.jsx(s.Field,{name:"preferences.receiveEmails",children:e=>n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(ae,{id:e.name,checked:e.state.value,onCheckedChange:e.handleChange}),n.jsx(x,{htmlFor:e.name,children:"Receive Email Updates"})]})}),n.jsx(s.Field,{name:"preferences.receiveSMS",children:e=>n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(he,{id:e.name,checked:e.state.value,onCheckedChange:e.handleChange}),n.jsx(x,{htmlFor:e.name,children:"Receive SMS Updates"})]})}),n.jsx(s.Field,{name:"preferences.theme",children:e=>n.jsxs("div",{className:"space-y-2",children:[n.jsx(x,{htmlFor:e.name,children:"Theme Preference"}),n.jsxs("div",{className:"flex space-x-4",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{type:"radio",id:"theme-light",name:e.name,value:"light",checked:e.state.value==="light",onChange:()=>e.handleChange("light")}),n.jsx(x,{htmlFor:"theme-light",children:"Light"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{type:"radio",id:"theme-dark",name:e.name,value:"dark",checked:e.state.value==="dark",onChange:()=>e.handleChange("dark")}),n.jsx(x,{htmlFor:"theme-dark",children:"Dark"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("input",{type:"radio",id:"theme-system",name:e.name,value:"system",checked:e.state.value==="system",onChange:()=>e.handleChange("system")}),n.jsx(x,{htmlFor:"theme-system",children:"System"})]})]})]})})]})]}),n.jsx(s.Field,{name:"terms",validators:{onChange:e=>e?{status:"success"}:{status:"error",error:"You must accept the terms and conditions"},onBlur:e=>e?{status:"success"}:{status:"error",error:"You must accept the terms and conditions"}},children:e=>n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(ae,{id:e.name,checked:e.state.value,onCheckedChange:e.handleChange}),n.jsx(x,{htmlFor:e.name,children:"I agree to the Terms and Conditions"})]}),e.state.meta.errors&&e.state.meta.errors[0]?.error?n.jsx("p",{className:"text-sm text-destructive",children:e.state.meta.errors[0].error}):null]})}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx(W,{type:"button",variant:"outline",onClick:()=>s.reset(),children:"Reset"}),n.jsxs("div",{className:"space-x-2",children:[n.jsx(W,{type:"button",variant:"outline",onClick:()=>{s.validate()},children:"Validate"}),n.jsx(W,{type:"submit",disabled:s.state.isSubmitting,children:s.state.isSubmitting?"Submitting...":"Submit"})]})]})]}),n.jsxs("div",{className:"mt-8 space-y-4",children:[n.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[n.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Form State"}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Dirty:"})," ",s.state.isDirty?"Yes":"No"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Valid:"})," ",s.state.isValid?"Yes":"No"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Submitting:"})," ",s.state.isSubmitting?"Yes":"No"]})]}),n.jsxs("div",{children:[n.jsxs("p",{children:[n.jsx("strong",{children:"Submitted:"})," ",s.state.isSubmitted?"Yes":"No"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Validating:"})," ",s.state.isValidating?"Yes":"No"]}),n.jsxs("p",{children:[n.jsx("strong",{children:"Touched:"})," ",s.state.isTouched?"Yes":"No"]})]})]})]}),i&&n.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[n.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Form Submission"}),n.jsx("pre",{className:"bg-card p-4 rounded-md text-xs overflow-auto",children:i})]})]})]})}const De=function(){return n.jsx("div",{className:"container py-8",children:n.jsx(Ce,{})})};export{De as component};
